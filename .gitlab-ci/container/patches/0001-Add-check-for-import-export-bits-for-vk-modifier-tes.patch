From f267a15f43ba7aded2d86dc6533105d5a92aa552 Mon Sep 17 00:00:00 2001
From: Lucas Fryzek <lucas.fryzek@fryzekconcepts.com>
Date: Thu, 14 Mar 2024 10:51:50 -0400
Subject: [PATCH] Add check for import & export bits for vk modifier tests

---
 .../vulkancts/modules/vulkan/modifiers/vktModifiersTests.cpp | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/external/vulkancts/modules/vulkan/modifiers/vktModifiersTests.cpp b/external/vulkancts/modules/vulkan/modifiers/vktModifiersTests.cpp
index daec05da2..2206eef14 100644
--- a/external/vulkancts/modules/vulkan/modifiers/vktModifiersTests.cpp
+++ b/external/vulkancts/modules/vulkan/modifiers/vktModifiersTests.cpp
@@ -167,7 +167,10 @@ bool verifyHandleTypeForFormatModifier (const InstanceInterface&				vki,
 	if (vki.getPhysicalDeviceImageFormatProperties2(physicalDevice, &imageFormatInfo, &imageProperties) == VK_ERROR_FORMAT_NOT_SUPPORTED)
 		return false;
 
-	if ((externalImageProperties.externalMemoryProperties.compatibleHandleTypes & handleType) != handleType)
+
+	vk::VkExternalMemoryFeatureFlags required_bits = VK_EXTERNAL_MEMORY_FEATURE_EXPORTABLE_BIT | VK_EXTERNAL_MEMORY_FEATURE_IMPORTABLE_BIT;
+	if ((externalImageProperties.externalMemoryProperties.compatibleHandleTypes & handleType) != handleType ||
+        !((externalImageProperties.externalMemoryProperties.externalMemoryFeatures & required_bits) == required_bits))
 		return false;
 
 	return true;
-- 
2.44.0

